-- SETTINGS
local TELEPORT_KEY = Enum.KeyCode.X  -- change keybind here
local TELEPORT_TIME = 1              -- seconds before teleporting back

-- SERVICES
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- VARIABLES
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera

-- GET CLOSEST PLAYER TO MOUSE
local function getClosestPlayerToMouse()
	local closestPlayer = nil
	local shortestDistance = math.huge

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer
			and player.Character
			and player.Character:FindFirstChild("HumanoidRootPart") then

			local hrp = player.Character.HumanoidRootPart
			local screenPos, onScreen = Camera:WorldToViewportPoint(hrp.Position)

			if onScreen then
				local distance = (Vector2.new(screenPos.X, screenPos.Y) -
					Vector2.new(Mouse.X, Mouse.Y)).Magnitude

				if distance < shortestDistance then
					shortestDistance = distance
					closestPlayer = player
				end
			end
		end
	end

	return closestPlayer
end

-- TELEPORT LOGIC
UserInputService.InputBegan:Connect(function(input, processed)
	if processed then return end
	if input.KeyCode ~= TELEPORT_KEY then return end

	local character = LocalPlayer.Character
	if not character or not character:FindFirstChild("HumanoidRootPart") then return end

	local root = character.HumanoidRootPart
	local originalCFrame = root.CFrame

	local targetPlayer = getClosestPlayerToMouse()
	if not targetPlayer or not targetPlayer.Character then return end

	local targetRoot = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
	if not targetRoot then return end

	-- Teleport to target
	root.CFrame = targetRoot.CFrame

	-- Wait then teleport back
	task.delay(TELEPORT_TIME, function()
		if root and root.Parent then
			root.CFrame = originalCFrame
		end
	end)
end)
